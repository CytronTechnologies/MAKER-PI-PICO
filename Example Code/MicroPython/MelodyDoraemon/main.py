from machine import *
from utime import sleep
from pitches import tones
import _thread

sleep(1)
print("MicroPython on Raspberry Pi Pico")
print()

pwm = PWM(Pin(25))
pwm.freq(1000)

tempo = 0.65

melody = (
    'a2','','a2','','a2','b2','','cs3',
    'a3','','d4','d4','','fs4','b4','','fs4','a4','',
    'a4','','b4','a4','','fs4','g4','','fs4','e4','',
    'b3','','e4','e4','','g4','cs5','','cs5','b4','',
    'a4','g4','','g4','','fs4','b3','','cs4','','d4','e4','',

    'a2','','a2','','a2','b2','','cs3',
    'a3','','d4','d4','','fs4','b4','','fs4','a4','',
    'a4','','b4','a4','','fs4','g4','','fs4','e4','',
    'b3','','e4','e4','','g4','cs5','','b4','','a4',
    'g4','','g4','fs4','','e4','cs4','','e4','','d4','',

    'd3','','e3','','fs3','',
    'b4','','b4','','a4','g4','a4','b4','a4','',
    'e4','','fs4','gs4','','e4','a4','',
    'b4','','a4','','e4','','fs4','gs4','','e4','a4','',

    'a2','','a3','','a2','',
    'b4','','a4','','g4','',
    'e4','','cs5','','b4','a4','','b4','a4','','g4','',
    'a4','','b4','fs4','','','e4','d4','',

    'd3','','e3','','fs3','',
    'b4','','a4','','g4','',
    'e4','','cs5','','b4','a4','','b4','a4','','g4','',
    'a4','','b4','fs4','','','e4','d4','',
)
rhythm = [
    4,2,4,4,4,4,4,4,
    4,4,4,4,4,4,4,4,4,4,2,
    4,4,4,4,4,4,4,4,4,4,2,
    4,4,4,4,4,4,4,4,4,4,4,
    4,4,2,4,4,4,4,4,4,2,4,2,4,

    4,2,4,4,4,4,4,4,
    4,4,4,4,4,4,4,4,4,4,2,
    4,4,4,4,4,4,4,4,4,4,2,
    4,4,4,4,4,4,4,2,4,4,4,
    4,4,4,4,4,4,4,2,4,2,2,4,

    4,2,4,2,4,2,
    4,2,4,4,4,4,4,4,4,2,
    4,4,4,4,4,4,2,1,
    4,2,4,2,4,4,4,4,4,4,2,4,

    4,2,4,2,4,2,
    4,2,4,2,2,1,
    4,2,4,4,4,4,4,4,4,4,2,2,
    4,4,4,2,2,4,4,2,4,

    4,2,4,2,4,2,
    4,2,4,2,2,1,
    4,2,4,4,4,4,4,4,4,4,2,2,
    4,4,4,2,2,4,4,2,4,
]

def main_2():
    for tone, length in zip(melody, rhythm):
        beeper = PWM(Pin(18))
        if tones[tone] != 0:
            beeper.duty_u16(2**15)
            beeper.freq(tones[tone])
        sleep(tempo/length)
        beeper.deinit()

_thread.start_new_thread(main_2, ())

duty = 0
direction = 1

while True:
    for _ in range(256):
        duty += direction
        if duty > 255:
            duty = 255
            direction = -1
        elif duty < 0:
            duty = 0
            direction = 1
        pwm.duty_u16(duty * duty)
        sleep(0.001)
